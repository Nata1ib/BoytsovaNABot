# Weather telegramm bot

## [Постановка задачи]([url](https://github.com/mycelium/j23#weather-bot))
> 1. Sign up
> 2. Sign in
> 3. Location
>  - Set location
>    - City
>    - Geomarker
>  - Show location
>  - Update location
> 4. Weather
>  - Show current (now + rest of the day)
>  - Show forecast (this day, next day, 3 days): morning, noon, evening
>  - Show for another city
> 5. Schedule
>  - Show every
## Выполненные задачи
- [X] Set location - City
- [X] Set location - Geomarker
- [X] Show current weather (now)


## Используемые технологии
- Java 17
- Spring Boot
- Maven
- Telegram Bot API[^1] 
- OpenWeatherMap API[^2]
- Yandex geocoder API[^3]

[^1]: Telegram Bot API - это набор интерфейсов и методов, предоставляемых Telegram, популярной платформой мгновенного обмена сообщениями. 
Этот API позволяет разработчикам создавать Telegram-ботов и взаимодействовать с ними, которые представляют собой специальные учетные записи,
предназначенные для автоматизации взаимодействий и предоставления услуг в рамках платформы Telegram.

[^2]: OpenWeatherMap API - популярный и широко используемый сервис данных о погоде, который предоставляет доступ к широкому спектру информации, 
связанной с погодой. Он предлагает различные погодные данные, включая текущие погодные условия, прогнозы, исторические данные о погоде и многое другое. 

[^3]: Yandex geocoder API - это API, предоставляемый российской многонациональной IT-компанией "Яндекс". Этот API позволяет разработчикам интегрировать 
функции геокодирования и обратного геокодирования в свои приложения. Геокодирование - это процесс преобразования адресов или названий мест в географические 
координаты (широту и долготу), в то время как обратное геокодирование делает обратное, преобразуя координаты в удобочитаемые адреса или названия мест.
## Реализация программы
1. _Bot_
   
   Этот класс представляет Telegram-бота, расширяя Telegram Longpollingbot и обрабатывая входящие сообщения.
   Он настроен на прослушивание обновлений, и когда получено сообщение, он обрабатывает его, взаимодействуя с _SendMessageService_.
   Токен и имя пользователя бота загружаются из свойств.
2. _BotConfiguration_

   Этот класс конфигурации определяет компонент TelegramBotsApi, который регистрирует бота для взаимодействия с Telegram API.
3. _OpenWeatherMapService_ и _OpenWeatherMapServiceImp_

   Эти классы отвечают за получение информации о погоде. _OpenWeatherMapService_ определяет методы получения информации о погоде, а
   _OpenWeatherMapServiceImp_ реализует эти методы. Он взаимодействует с API OpenWeatherMap для получения данных о погоде на основе
   местоположения и обработки ответов.
   
   _OpenWeatherMapService_ подключает необходимые библиотеки для работы с XML, JSON, и другими инструментами.
   - Через аннотации @Value и @Service, он получает конфигурационные параметры из внешних источников, такие как appId для OpenWeatherMap
     и yandexId для Yandex Geocoder.
   - OpenWeatherMapServiceImp реализует интерфейс OpenWeatherMapService и предоставляет метод getWeatherInfo для получения информации о погоде на
     основе текстового запроса.
   - Есть метод YandexMapsXMLParser, который разбирает XML-ответ от Yandex Geocoder и извлекает название города.
   - Метод getWeatherInfoByLocation позволяет получить информацию о погоде на основе координат (широты и долготы) с использованием Yandex Geocoder.
   - Метод getResponse выполняет запрос к API OpenWeatherMap, чтобы получить информацию о погоде.
   - Метод createString формирует текстовый ответ, включая информацию о местоположении, температуре, описании погоды, влажности, времени восхода и заката солнца.
   - getTime преобразует временные метки в удобный формат времени.
5. _SendMessageService_ и _SendMessageServiceImp_

   Эти классы обрабатывают отправку сообщений пользователям Telegram. _SendMessageService_ определяет интерфейс, а _SendMessageServiceImp_
   реализует его. Он форматирует и отправляет сообщения пользователям на основе их входных данных и данных о местоположении.
   SendMessageServiceImp использует OpenWeatherMapServiceImp для получения информации о погоде.

   _SendMessageServiceImp_ реализован по следующему принципу.
   - Когда пользователь отправляет сообщение боту, этот сервис принимает его через метод send, который принимает объект Message от Telegram API.
   - В зависимости от содержания сообщения пользователя, код принимает различные действия:
     - Если пользователь отправляет "/start", бот отправляет приветственное сообщение, полученное из messageSource.
     - Если пользователь отправляет геолокацию, сервис извлекает координаты и передает их в метод getWeatherInfoByLocation предыдущего сервиса
       openWeatherMapService для получения информации о погоде в этом местоположении.
     - В противном случае (если сообщение не является командой "/start" и не содержит геолокацию), сервис передает текстовое сообщение пользователя в метод
       getWeatherInfo для получения информации о погоде на основе текстового запроса.
   - Полученная информация о погоде сохраняется в переменной result.
   - Затем, создается объект SendMessage, который содержит текстовое сообщение (text), устанавливается режим разметки (parseMode), и указывается идентификатор
     чата (chatId) для отправки обратно пользователю в Telegram.

7. _application.properties_ и _messages.properties_
   
   Первый файл свойств содержит значения конфигурации, такие как токен Telegram-бота, ключ API OpenWeatherMap и другие настройки.
   Второй - приветствие и сообщения, определенные в файле свойств для использования в ответах бота.

8. _Clouds_, _Coord_, _Main_, _Result_, _Sys_, _Weather_ и _Wind_


   Это классы, каждый из которых представляет определенную часть структуры ответа JSON. Эти классы предназначены для отображения данных
   JSON в объекты Java для упрощения манипулирования.
## Результаты работы программы
На приведённых ниже фото приведены результаты работы программы из приложения Telegramm.
<p align="center">
  
<picture>
   <img src="https://github.com/poolins/weatherBot/blob/04d147db39bcffd8f05fbc143e15345e6c738a5f/WorkingOfBot1%5C.jpeg" width="200">
</picture>

<picture>
   <img src="https://github.com/poolins/weatherBot/blob/04d147db39bcffd8f05fbc143e15345e6c738a5f/WorkingOfBot2.jpeg" width="200">
</picture>



<picture>
   <img src="https://github.com/poolins/weatherBot/blob/2eb5ca0e86fe548a9125cf9345926aa206c3c41d/photo_2023-10-14%2000.34.26.jpeg" width="200">
</picture>

</p>
